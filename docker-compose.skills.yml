# Docker Compose override for OpenClaw with skill dependencies
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.skills.yml up -d
#
# This override:
#   1. Uses the skills-enabled Dockerfile (Dockerfile.skills)
#   2. Adds skill API key environment variables
#   3. Uses the entrypoint script for runtime plugin installation
#
# Before starting:
#   1. Copy .env.example to .env and fill in your credentials
#   2. Create ~/.openclaw/openclaw.json with your skill/plugin config
#   3. Optionally create ~/.openclaw/plugins-install.txt for runtime plugins

services:
  openclaw-gateway:
    build:
      context: .
      dockerfile: Dockerfile.skills
    environment:
      HOME: /home/node
      TERM: xterm-256color
      # Gateway auth
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
      # Claude provider credentials
      CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY:-}
      CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY:-}
      CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE:-}
      # Skill configuration
      SKILLS_INSTALL_PREFER_BREW: "false"
      # Skill API keys (from .env)
      GEMINI_API_KEY: ${GEMINI_API_KEY:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      NOTION_API_KEY: ${NOTION_API_KEY:-}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY:-}
      GOOGLE_PLACES_API_KEY: ${GOOGLE_PLACES_API_KEY:-}
      TRELLO_API_KEY: ${TRELLO_API_KEY:-}
      TRELLO_TOKEN: ${TRELLO_TOKEN:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      # Twilio (for WhatsApp)
      TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID:-}
      TWILIO_AUTH_TOKEN: ${TWILIO_AUTH_TOKEN:-}
      TWILIO_WHATSAPP_FROM: ${TWILIO_WHATSAPP_FROM:-}
    volumes:
      - ${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR}:/home/node/.openclaw/workspace
    ports:
      - "${OPENCLAW_GATEWAY_PORT:-18789}:18789"
      - "${OPENCLAW_BRIDGE_PORT:-18790}:18790"
    init: true
    restart: unless-stopped
    command:
      [
        "node",
        "dist/index.js",
        "gateway",
        "--bind",
        "${OPENCLAW_GATEWAY_BIND:-lan}",
        "--port",
        "18789",
      ]

  openclaw-cli:
    build:
      context: .
      dockerfile: Dockerfile.skills
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
      BROWSER: echo
      CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY:-}
      CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY:-}
      CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE:-}
      # Skill configuration
      SKILLS_INSTALL_PREFER_BREW: "false"
      # Skill API keys
      GEMINI_API_KEY: ${GEMINI_API_KEY:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      NOTION_API_KEY: ${NOTION_API_KEY:-}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY:-}
      GOOGLE_PLACES_API_KEY: ${GOOGLE_PLACES_API_KEY:-}
      TRELLO_API_KEY: ${TRELLO_API_KEY:-}
      TRELLO_TOKEN: ${TRELLO_TOKEN:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
    volumes:
      - ${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR}:/home/node/.openclaw/workspace
    stdin_open: true
    tty: true
    init: true
    entrypoint: ["/app/docker/entrypoint.sh"]
    command: ["node", "dist/index.js"]
